Date: 2025-11-29
Version: 2.3.10B "Velocity" (Feature Parity & Error Reporting)

## DESCRIPTION
This release significantly enhances the robustness of the library by expanding error reporting and ensuring correct feature management across both OpenGL and Vulkan backends. It addresses critical gaps in error code handling and implements proper feature detection and enablement for Vulkan extensions.

## CRITICAL FIXES & SAFETY
*   **Comprehensive Error Support:** Added a full block of `NETWORK` error codes (`-900` to `-907`) and updated `_SituationSetErrorFromCode` to include specific case handlers for *every* `SituationError` defined in the enum. This eliminates generic "Unknown Error" messages for defined failure states.
*   **Renaming:** Renamed `SituationFeature` to `SituationRenderFeature` to better reflect its scope and purpose within the graphics subsystem.
*   **Vulkan Feature Management:**
    *   Fixed a critical issue in `_SituationVulkanCreateLogicalDevice` where optional features (Mesh Shaders, Ray Tracing) were not being correctly enabled.
    *   Implemented robust `pNext` chaining logic to properly link `VkPhysicalDeviceMeshShaderFeaturesEXT`, `VkPhysicalDeviceRayTracingPipelineFeaturesKHR`, and other feature structs to the `VkDeviceCreateInfo` chain. This ensures that requested features are actually activated on the logical device.
*   **OpenGL Feature Detection:** Updated `_SituationInitOpenGL` to correctly populate the `enabled_features_mask` based on available GLAD extensions and core version capabilities, ensuring `SituationIsFeatureSupported` returns accurate results.

--------------------------------------------------------------------------------

Date: 2025-11-29
Version: 2.3.10A "Velocity" (Stability Fixes & Optimization)

## DESCRIPTION
This is a "surgical fix" release targeting stability, memory safety, and text rendering performance. It introduces configurable memory allocators, C++ RAII wrappers for strings, and a significant optimization for text rendering that replaces character-by-character draw calls with batched rendering.

## CRITICAL FIXES & SAFETY
*   **Memory Safety Macros:** Replaced all internal calls to `malloc`, `calloc`, `realloc` with overridable macros `SIT_MALLOC`, `SIT_CALLOC`, `SIT_REALLOC`. This allows users to integrate custom allocators (e.g., for tracking or pools) by defining these macros before including the header.
*   **RAII String Wrapper (C++):** Added `SituationScopedString` struct for C++ users. This RAII wrapper automatically calls `SituationFreeString()` when it goes out of scope, preventing memory leaks from API functions that return heap-allocated strings (like `SituationGetLastErrorMsg`).

## OPTIMIZATIONS
*   **Batched Text Rendering:** Completely rewrote `SituationCmdDrawText`.
    *   **Old Behavior:** Issued one draw call per character, causing massive driver overhead.
    *   **New Behavior:** Batches all characters into a single dynamic vertex buffer and issues one draw call per string.
    *   **Backend Support:** Implemented efficient dynamic buffer updates for both OpenGL (`glNamedBufferSubData`) and Vulkan (Staging Buffer + Pipeline Barrier).

--------------------------------------------------------------------------------

Date: 2025-11-29
Version: 2.3.10 "Velocity" (Feature Flag System & API Refinement)

## DESCRIPTION
This release introduces a comprehensive Feature Flag system to `situation.h`, enabling applications to query granular GPU capabilities at runtime. It also resolves critical compilation issues in the OpenGL backend related to extension macros and duplicate definitions.

## NEW FEATURES
*   **Feature Flag System:** Introduced the `SituationFeature` enum and `SituationIsFeatureSupported()` function.
    *   Allows querying support for advanced features like `SIT_FEATURE_BINDLESS_BUFFERS`, `SIT_FEATURE_MESH_SHADER`, `SIT_FEATURE_RAY_TRACING`, and more.
    *   Automatically populated during backend initialization based on available extensions and driver limits.

## CRITICAL FIXES
*   **Compilation Fixes:**
    *   Corrected the definition order of `SITAPI` to resolve "expected ‘;’ before ‘void’" errors.
    *   Removed duplicate function definitions (`SituationGetBufferDeviceAddress`, `SituationGetTextureHandle`) that caused redefinition errors.
    *   Added proper `#ifdef` guards around OpenGL extension macros (`GLAD_GL_NV_shader_buffer_load`, etc.) to prevent compile-time failures when extensions are missing from the loader.
*   **Missing Definitions:** Verified presence of `_SituationCachePhysicalDisplays` and `_SituationGLFWJoystickCallback` to resolve linker warnings.

## DOCUMENTATION
*   **Versioning:** Updated all version macros and documentation to 2.3.10.

--------------------------------------------------------------------------------

Date: 2025-11-29
Version: 2.3.9 "Velocity" (Vulkan 1.2 & Buffer Device Address)

## DESCRIPTION
This release marks a critical update to the Situation SDK, bumping the minimum Vulkan requirement to version 1.2. This change enables access to advanced features like Bindless Descriptors and Buffer Device Address, paving the way for high-performance GPU-driven rendering architectures.

## API ADDITIONS

*   **Bindless Graphics & Compute:**
    *   `SituationGetBufferDeviceAddress`: Retrieves the 64-bit physical GPU address of a buffer, enabling direct pointer access in shaders via `GL_EXT_buffer_reference`.
    *   `SituationGetTextureHandle`: Retrieves a 64-bit handle for bindless texture access (OpenGL only).
    *   `SituationCmdBindSampledTexture`: Binds a texture specifically for sampling (sampler2D) operations, distinct from storage image bindings.

*   **Compute Workflow Enhancements:**
    *   `SituationCmdPresent`: Introduced a command to manually present a texture to the swapchain. This is essential for "Compute-Only" pipelines where the final image is generated by a compute shader rather than a rasterization pass.
    *   `SIT_COMPUTE_LAYOUT_BUFFER_IMAGE`: Added a new compute layout configuration supporting one SSBO and one Storage Image, optimizing binding for common post-processing shaders.

*   **Image Module Utilities:**
    *   `SituationCreateImage`: Added helper to allocate an uninitialized CPU-side image buffer.
    *   `SituationBlitRawDataToImage`: Efficiently copies raw byte arrays into an image region (useful for font atlas generation).
    *   `SituationSetPixelColor`: CPU-side helper for setting individual pixels.

## TECHNICAL CHANGES

*   **Vulkan 1.2 Mandate:**
    *   The internal Vulkan initialization sequence now explicitly requests API version 1.2.
    *   `bufferDeviceAddress` feature is enabled during logical device creation if supported by the GPU.
    *   VMA (Vulkan Memory Allocator) configuration updated to target Vulkan 1.2.

*   **Internal Refactoring:**
    *   Updated `_SituationVulkanState` and initialization logic to support the expanded compute layout array.
    *   Standardized `SituationCmdPresent` implementation across OpenGL (using `glBlitNamedFramebuffer`) and Vulkan (using `vkCmdBlitImage` and barrier transitions).

--------------------------------------------------------------------------------

Date: 2025-11-29
Version: 2.3.8B "Velocity" (Production Readiness)

## DESCRIPTION
This release is an affirming hardening production readiness release. It aims to polish and wrap up the progressive work done in the "Velocity" saga from codebase to the SDK documentation.

## IMPROVEMENTS

*   **Documentation Polish:** Comprehensive review and update of the SDK documentation (`situation_sdk_238.md`) to reflect the finalized state of the Velocity module.
*   **Version Synchronization:** Aligned version numbers across all documentation and header files to 2.3.8B.

--------------------------------------------------------------------------------

Date: 2025-11-29
Version: 2.3.8A "Velocity" (Hotfix A)

## DESCRIPTION
This release achieves production-readiness for the "Velocity" hot-reloading module. It introduces a robust "Fail-Safe" reloading architecture that prevents application crashes or visual corruption when reloading assets with errors.

## NEW FEATURES

*   **Fail-Safe Hot-Reloading:**
    *   **Shaders:** Refactored `SituationReloadShader` and `SituationReloadComputePipeline` to use a "Load-Swap-Destroy" pattern. New shaders are compiled and verified *before* the old ones are destroyed. If compilation fails, the old shader remains active, and an error is logged. This prevents "black screen" states during shader development.
    *   **Textures:** Applied fail-safe logic to `SituationReloadTexture`. Invalid image files or load errors no longer invalidate the existing texture handle.
    *   **Models:** Implemented deep-swap reloading for `SituationReloadModel`. The entire model hierarchy (meshes and textures) is rebuilt in the background and swapped atomically on success.
    *   **Stability:** The hot-reload loop (`SituationCheckHotReloads`) is now resilient to list mutation and ensures safe iteration even if resources are added or removed during the reload process.

## CRITICAL FIXES

*   **Internal robustness:** Corrected resource tracking node management during reloads to prevent memory leaks and ensure persistent tracking of reloaded assets.

--------------------------------------------------------------------------------

Date: 2025-11-29
Version: 2.3.8 "Velocity" (Hot-Reload Implementation & API Fixes)

## DESCRIPTION
This release finalizes the "Velocity" feature set by implementing the Hot-Reloading module and addressing critical API inconsistencies. It introduces the `SituationCheckHotReloads` function, enabling runtime asset reloading, and corrects strict typing issues in the Input and Graphics modules.

## NEW FEATURES

*   **Hot-Reloading Implementation:** Fully implemented `SituationCheckHotReloads` and resource tracking.
    *   **Resource Tracking:** Internal resource nodes (`_SituationShaderNode`, `_SituationTextureNode`, `_SituationModelNode`, `_SituationComputePipelineNode`) now store source file paths and last modification times.
    *   **Loader Integration:** `SituationLoadShader`, `SituationLoadTexture`, `SituationLoadModel`, and `SituationCreateComputePipeline` now capture file modification times upon successful load.
    *   **Polling:** `SituationCheckHotReloads` (intended for development builds) polls these files for changes and triggers the appropriate `SituationReload*` function.

## CRITICAL FIXES

*   **Input API Strict Typing:** Corrected function signatures in `situation.h` for `SituationSetMousePosition`, `SituationSetMouseOffset`, and `SituationSetMouseScale`. They now correctly accept `Vector2` structs instead of `vec2` arrays, matching their implementations and ensuring Strict C11 compliance.
*   **Vulkan/OpenGL State Consistency:** Moved `last_vd_composite_time_ms` from the backend-specific structs to the common `_SituationGlobalStateContainer`. This fixes a bug where profiling data was inaccessible or reading from uninitialized memory depending on the active backend.
*   **OpenGL Error Macro Visibility:** Added a forward declaration for `_SituationLogGLError` in the public section of `situation.h`. This ensures the `SIT_CHECK_GL_ERROR` macro compiles correctly in user applications when `SITUATION_USE_OPENGL` is defined.
*   **Memory Leaks Plugged:** Fixed memory leaks in `SituationDestroyTexture`, `SituationUnloadShader`, `SituationUnloadModel`, and `SituationDestroyComputePipeline` where the path strings (`source_path`, `vs_path`, `fs_path`) tracked for hot-reloading were not being freed during destruction.
*   **Hot-Reload Loop Prevention:** Updated `SituationCheckHotReloads` to update the file modification timestamp *before* attempting a reload. This prevents infinite retry loops and GPU stalls if a file has syntax errors (avoiding a "reload -> fail -> retry next frame" cycle).

--------------------------------------------------------------------------------

Date: 2025-11-29
Version: 2.3.7C "Velocity" (Graveyard & Reverb Documentation)

## DESCRIPTION
This update focuses on documentation completeness and internal clarity. It retroactively documents the "Graveyard" deferred destruction system introduced in previous versions and finalizes the description of the embedded reverb implementation.

## DOCUMENTATION

*   **Vulkan Graveyard:** Added comprehensive internal documentation for `SituationGraveyard` and its associated helper functions (`_SituationInitGraveyard`, `_SituationFlushGraveyard`). This clarifies how the library prevents GPU stalls during resource destruction.
*   **Reverb Internals:** Documented the Schroeder/Freeverb implementation details, including the structure of the `SituationReverbState` and the logic behind the parallel comb filters and all-pass filters.

--------------------------------------------------------------------------------

Date: 2025-11-28
Version: 2.3.7B "Velocity" (Embedded Reverb Implementation)

## DESCRIPTION
This patch implements a custom Schroeder/Freeverb reverberation algorithm directly within the `situation.h` header, replacing the missing `miniaudio` reverb dependency. This ensures that the `SituationSetSoundReverb` function is fully operational and self-contained, providing high-quality environmental audio effects without requiring external DSP libraries.

## NEW FEATURES

*   **Embedded Reverb Algorithm:** Implemented a complete Schroeder/Freeverb reverb engine (8 comb filters, 4 all-pass filters) within the library's implementation block. This restores full functionality to the `SituationSetSoundReverb` API, enabling Room Size, Damping, and Wet/Dry mix controls.
*   **Opaque State Management:** The public `SituationSound` struct now uses an opaque `void* reverb_state` pointer, completely hiding the internal reverb data structures (`SituationReverbState`, `SituationReverbComb`, etc.) from the public API. This improves encapsulation and prevents ABI breakage if the reverb implementation changes in the future.

## CRITICAL FIXES

*   **Missing Dependency Resolution:** Replaced calls to non-existent `ma_reverb` functions with internal helpers (`_SituationInitReverb`, `_SituationProcessReverb`, `_SituationUninitReverb`). The Audio Engine now initializes and processes the custom reverb chain seamlessly as part of the standard audio pipeline.
*   **Initialization Safety:** Added robust null checks for memory allocation in `_SituationInitReverb` to prevent potential crashes during sound loading or effect initialization.
*   **API Cleanliness:** Removed redundant macro definitions (`SIT_REVERB_COMB_COUNT`, etc.) from the public header section, keeping the global namespace clean.

--------------------------------------------------------------------------------

Date: 2025-11-28
Version: 2.3.7A "Velocity" (Audio Safety Hotfix)

## DESCRIPTION
This hotfix addresses critical stability regressions introduced in the 2.3.7 Audio Architecture Refactor. It focuses on ensuring that the Audio API is robust against invalid usage and that the core initialization check is correctly exported for external use.

## CRITICAL FIXES

*   **Audio API Safety Guards:** Implemented explicit `SituationIsInitialized()` checks at the entry point of every public Audio API function. This prevents the application from crashing with a null pointer dereference if audio functions (like `SituationPlayLoadedSound` or `SituationSetAudioDevice`) are called before `SituationInit()` or after `SituationShutdown()`. Instead of crashing, these functions now safely return an error code.
*   **SITAPI Export Fix:** The implementation of `SituationIsInitialized()` was missing the `SITAPI` macro in its definition. This has been corrected to ensure the function is properly exported in shared library (DLL) builds, matching its forward declaration.
*   **Error Reporting Safety:** Hardened the `_SituationSetError` internal helper to check for a valid context pointer before attempting to write error messages. This prevents a secondary crash when the library attempts to report an "Uninitialized" error.

--------------------------------------------------------------------------------

Date: 2025-11-26
Version: 2.3.7 "Velocity" (Audio Architecture Refactor)

## DESCRIPTION
This release finalizes the architectural separation of the Audio subsystem from the central global state. It moves all audio-related state into a dedicated `_SituationAudioState` container (`sit_audio`), improving modularity and memory organization. This update also includes critical fixes for audio capture and device management that were identified during the refactor.

## CRITICAL FIXES

*   **Audio State Separation:** Completed the migration of audio state variables (MiniAudio context, device handles, capture queues) from `sit_gs` to the new `sit_audio` static container. This decoupling ensures cleaner subsystem isolation.
*   **Audio Capture Logic:** Fixed a severe logic error in `SituationPollInputEvents` where the audio capture ring buffer's write head was being incorrectly initialized with the read head's value, and where state was being read from the wrong structure. This restores functional audio capture on the main thread.
*   **User Data Pointer Safety:** Corrected `SituationStartAudioCapture` and `SituationSetAudioDevice` to pass the correct `&sit_audio` pointer to MiniAudio callbacks. Previously, they passed `&sit_gs`, which would have caused a crash or memory corruption when the callback cast it to `_SituationAudioState*`.

--------------------------------------------------------------------------------

Date: 2025-11-25
Version: 2.3.6 "Velocity" (OpenGL Hardening & DSA Optimization)

## DESCRIPTION
This release hardens the OpenGL backend by strictly enforcing OpenGL 4.6 Core Profile at context creation. It also refactors the internal rendering pipeline to utilize Direct State Access (DSA), resulting in significantly faster internal rendering passes by eliminating CPU-GPU pipeline stalls.

## BREAKING CHANGES
*   **macOS Support Dropped:** By enforcing OpenGL 4.6, this library is no longer compatible with macOS (which is capped at OpenGL 4.1). Users on macOS must now use the Vulkan backend (via MoltenVK) or remain on v2.3.5.
*   **Legacy GPU Support Dropped:** Older integrated graphics (pre-Intel Skylake/HD 500 series) that do not support GL_ARB_direct_state_access will now fail to initialize SituationInit.

## TECHNICAL DETAILS
*   **Strict Context Creation:** `_SituationInitWindow` now sends strict hints to GLFW to request an OpenGL 4.6 Core Profile context. If the driver cannot provide it, window creation fails immediately.
*   **Elimination of State Query Stalls:** The `_SitGLBackupState` function has been optimized to remove slow `glGetIntegerv` calls that queried texture unit bindings, which are no longer needed with DSA.
*   **DSA Implementation:** `SituationRenderVirtualDisplays` now uses `glBindTextureUnit` for direct texture binding, eliminating the need to modify `glActiveTexture` state.
*   **Immutable Buffer Storage:** `SituationCreateBuffer` now mandates `glNamedBufferStorage` (Immutable Storage) over `glBufferData` (Mutable), providing better optimization hints to the driver.

--------------------------------------------------------------------------------

Date: 2025-11-25
Version: 2.3.5B "Velocity" (Documentation Overhaul)

## DESCRIPTION
This release is a comprehensive documentation overhaul, bringing the `situation_api.md` programming guide to 100% parity with the `v2.3.5A` "Velocity" header. It addresses the significant documentation debt accrued over multiple hotfix and feature releases, ensuring every public function, struct, and feature is now fully and accurately documented. This makes the library significantly easier to learn, use, and maintain.

## DOCUMENTATION

*   **Complete API Parity:** Performed a full audit of `situation.h` against `situation_api.md`. Every undocumented function has been added to the guide.
*   **New Modules Documented:**
    *   **Hot-Reloading Module:** Added a complete section for the "Velocity" Hot-Reloading feature set (`SituationCheckHotReloads`, `SituationReloadShader`, `SituationReloadTexture`, etc.), explaining its usage and benefits for rapid development.
    *   **Audio Capture API:** Added a new "Audio Capture" subsection to the Audio Module, documenting `SituationStartAudioCapture`, `SituationStopAudioCapture`, and related functions.
*   **Signature Corrections & Refinements:**
    *   Updated dozens of function signatures and usage examples throughout `situation_api.md` to reflect the strict C11 `struct`-based approach (e.g., changing `vec2` return types to `Vector2`).
    *   Corrected parameter lists and descriptions for functions whose behavior had diverged from the old documentation (e.g., `SituationSetSoundReverb`, `SituationGenImageGradient`).
    *   Added documentation for recently introduced performance and hardware query functions (`SituationGetVRAMUsage`, `SituationGetDrawCallCount`).
*   **Structural Improvements:** Re-organized sections for better logical flow and readability. Ensured all new entries follow the established documentation format with clear signatures, descriptions, and copy-paste-friendly usage examples.

## CONSISTENCY & AESTHETICS

*   **Version Sync:** The version number in `situation_api.md` is now correctly updated to `v2.3.5B`.
*   **Formatting:** Ensured consistent Markdown formatting, code blocks, and section headers across the entire document.

--------------------------------------------------------------------------------

Date: 2025-11-25
Version: 2.3.5A "Velocity" (Pristine)

## DESCRIPTION
This is a documentation and refinement release. Following the major performance overhaul in 2.3.5, this update focuses on making the solutions "absolutely pristine" by adding comprehensive documentation and ensuring the code is clean, consistent, and easy to understand. It verifies that the fixes for the critical performance bottlenecks are robust and clearly explains the "why" behind the architecture.

## DOCUMENTATION & REFINEMENT

*   **Vulkan Graveyard System:** Added a detailed documentation block explaining the entire deferred deletion ("graveyard") system. It explicitly details how this architecture solves the `vkDeviceWaitIdle` abuse problem by queuing resources for deletion instead of stalling the GPU.
*   **Asynchronous Uploads:** Added a comprehensive header to the `_SituationVulkanCreateAndUploadBuffer` function. It now clearly documents the dual-path (asynchronous/synchronous) mechanism and explains how the asynchronous path eliminates CPU-GPU stalls during in-game asset streaming.
*   **Linear Descriptor Allocation:** Verified that `vkFreeDescriptorSets` is not used in the hot path. Added documentation to the `_SituationVulkanAllocateDescriptorSet` function explaining how the "Dynamic Descriptor Manager" acts as a high-performance, auto-growing linear allocator, solving the descriptor pool fragmentation issue.
*   **API Consistency:** Refined internal function signatures for the deferred deletion system for better consistency.

--------------------------------------------------------------------------------

Date: 2025-11-25
Version: 2.3.5 "Velocity"

## DESCRIPTION
This release focuses on critical performance optimization for the Vulkan backend. It eliminates severe CPU-side stalls during resource management and data transfer, transforming the engine's streaming capabilities. It also implements a "Linear Allocator" strategy for descriptor pools to prevent fragmentation and reduce allocation overhead.

## CRITICAL PERFORMANCE FIXES

*   **Deferred Resource Destruction:** Implemented a `SituationGraveyard` system. Resources (Buffers, Images, Pipelines, Descriptor Sets) destroyed during a frame are no longer deleted immediately (which required a stalling `vkDeviceWaitIdle`). Instead, they are queued and safely destroyed only after the frame that used them has completed execution on the GPU. This eliminates the massive frame spikes previously seen during asset unloading.
*   **Asynchronous Buffer Uploads:** Refactored `_SituationVulkanCreateAndUploadBuffer`. It now uses the main command buffer to perform data transfers when inside a frame, inserting pipeline barriers for synchronization. This replaces the previous synchronous "allocate-record-submit-wait" cycle for every single buffer creation, significantly speeding up asset loading during gameplay.
*   **Linear Descriptor Allocation:** Modified the `_SituationFlushGraveyard` logic to skip individual `vkFreeDescriptorSets` calls. By treating descriptor pools as append-only and resetting/destroying them only when full or at shutdown, we eliminate memory fragmentation and the high CPU cost of freeing sets individually.

--------------------------------------------------------------------------------

Date: 2025-11-24
Version: 2.3.4M "Velocity" (Hotfix M)

## DESCRIPTION
This release focuses on "surgical precision" in error handling and reporting. It ensures that every error code defined in the library is correctly mapped to a human-readable string, eliminating "Unknown Error" responses for defined failures. It also hardens the Hot-Reloading module against race conditions and resource invalidation.

## CRITICAL FIXES

*   **Exhaustive Error Mapping:** Updated `_SituationSetErrorFromCode` to include `case` statements for *every* `SITUATION_ERROR_*` constant defined in the enum. This guarantees that all internal failures report specific, actionable error messages instead of falling back to generic codes.
*   **Hot-Reload Safety:** Enhanced `SituationReloadShader`, `SituationReloadTexture`, `SituationReloadModel`, and `SituationReloadComputePipeline` to explicitly check for GPU synchronization failures (`vkDeviceWaitIdle`). If the GPU cannot be idled (e.g., device lost), the reload operation now safely aborts with `SITUATION_ERROR_HOTRELOAD_GPU_SYNC_FAILED` instead of risking a crash or undefined behavior.
*   **Precise Error Reporting:**
    *   `_SituationInitOpenGL` now returns `SITUATION_ERROR_OPENGL_UNSUPPORTED_VERSION` (instead of generic unsupported) when the GL version check fails.
    *   Vulkan internal resource creation (Depth Resources) now specifically reports `SITUATION_ERROR_VULKAN_MEMORY_ALLOCATION_FAILED` on allocation failure.
    *   Hot-reload functions now return `SITUATION_ERROR_RESOURCE_INVALID` if the source file path was not correctly tracked, aiding in debugging.

--------------------------------------------------------------------------------

Date: 2025-11-24
Version: 2.3.4L "Velocity" (Hotfix L)

## DESCRIPTION
This release brings the SDK documentation and codebase into perfect synchronization regarding error handling. It resolves long-standing discrepancies in error code values and introduces granular, actionable error reporting for the Vulkan backend. Additionally, it addresses critical header dependency issues to ensure robust compilation in strict C environments.

## CRITICAL FIXES

*   **Header Compilation & Dependency Ordering:** Solved a compilation order dependency in `situation.h`. Moved `SituationError` and `SituationBufferUsageFlags` typedefs to the top of the header. This ensures that these types are defined before they are used in function prototypes or macros (like `SITUATION_LOG_WARNING`), preventing "unknown type" errors in single-pass C compilers.
*   **Vulkan Descriptor Logic:** Fixed a memory leak in `_SituationVulkanAllocateDescriptorSet`. Previously, if `realloc` failed, the original pointer was lost. The logic now safely handles reallocation failures.

## ERROR HANDLING & DOCUMENTATION

*   **Error Code Synchronization:** Performed a comprehensive audit of `situation.h` and `situation_sdk_234.md`.
    *   Verified `SITUATION_ERROR_UNKNOWN_ERROR` is explicitly `-999`.
    *   Updated documentation to match implementation values for `SITUATION_ERROR_INVALID_ENUM` (-4), `SITUATION_ERROR_ALREADY_INITIALIZED` (-310), and filesystem errors (-550, -551).
*   **Granular Vulkan Errors:** Implemented specific, high-value error codes for the Vulkan backend to aid in debugging resource exhaustion:
    *   `_SituationVulkanAllocateDescriptorSet` now returns `SITUATION_ERROR_VULKAN_DESCRIPTOR_POOL_EXHAUSTED` (-749) instead of a generic error.
    *   `_SituationVulkanCreateImage` and `_SituationVulkanCreateAndUploadBuffer` now return `SITUATION_ERROR_VULKAN_MEMORY_ALLOCATION_FAILED` (-750) on memory failures.

--------------------------------------------------------------------------------

Date: 2025-11-24
Version: 2.3.4K "Velocity" (Hotfix K)

## DESCRIPTION
This micro-hotfix delivers a single-line safeguard for OpenGL backend portability, ensuring seamless compilation in header-only environments without external GL headers.

## CRITICAL FIXES

*   **GLFW Include Guard:** Added `#define GLFW_INCLUDE_NONE` immediately before `<GLFW/glfw3.h>` inclusion to prevent GLFW from auto-including system `GL/gl.h` (or GL ES equivalents). This resolves "missing header" compilation failures in minimal setups (e.g., cross-compiles, embedded toolchains, or when bundling with GLAD). The change is non-intrusive, with zero runtime impact, and maintains full compatibility with existing builds.

## DOCUMENTATION

*   **Inline Comment:** Accompanied the define with a precise, self-explanatory comment detailing the rationale, environments affected, and synergy with GLAD loader. This enhances developer onboarding without bloating the header.

--------------------------------------------------------------------------------

Date: 2025-11-24
Version: 2.3.4J "Velocity" (Hotfix J)

## DESCRIPTION
This release delivers critical stability fixes for the audio subsystem and resource management, specifically targeting initialization logic, 64-bit system compatibility, and memory safety during asset loading.

## CRITICAL FIXES

*   **Audio Initialization Logic:** Resolved a critical logic error in `_SituationInitSubsystems` where the audio capture initialization block was unreachable due to incorrect nesting within an error check. The `SITUATION_INIT_AUDIO_CAPTURE_MAIN_THREAD` flag now correctly initializes the capture ring buffer.
*   **64-bit Pointer Safety:** Fixed a truncation bug where Vulkan and OpenGL resource handles (which are pointers) were being cast to `uint32_t` before being assigned to `uint64_t` IDs. This caused invalid handles on 64-bit systems. Handles are now correctly cast to `uintptr_t` first.
*   **Model Loading Safety:** Added robust `NULL` checks for `calloc` memory allocations in `SituationLoadModel`.
*   **Resource Cleanup on Failure:** Implemented proper cleanup logic in `SituationLoadModel`. If mesh allocation fails after textures have been loaded, the function now correctly destroys the loaded textures before returning, preventing resource leaks.
*   **API Consistency:** Updated `_SituationInitSubsystems` to accept `const SituationInitInfo*` to match the initialization flow.

--------------------------------------------------------------------------------

Date: 2025-11-23
Version: 2.3.4I "Velocity" (Hotfix I)

## DESCRIPTION
This release, designated "Surgical Fixes," focuses on resolving specific defects identified in the codebase, ranging from strict C11 compliance issues to logic bugs in resource creation and input handling.

## CRITICAL FIXES

*   **Resource Initialization:** Fixed a critical bug in `SituationCreateBuffer` where `buffer.usage_flags` was not being assigned, potentially leading to undefined behavior or validation errors in backend resource creation.
*   **Pointer Safety:** Corrected a pointer access error in `SituationDestroyTexture` (`texture.id` -> `texture->id`), preventing compilation errors and potential crashes during cleanup.
*   **Clipboard Logic:** Fixed `SituationSetClipboardText` to correctly pass the `text` argument to the underlying GLFW function, restoring clipboard functionality.

## API COMPLIANCE & REFACTORING

*   **C11 Compliance (Input Module):** Refactored mouse input functions (`SituationGetMousePosition`, `SituationGetMouseDelta`, `SituationGetMouseWheelMoveV`) to return `Vector2` structs instead of `vec2` arrays. This resolves a strict C11 compliance violation regarding returning arrays from functions.
*   **Implementation Correctness:** Updated the implementation of the above mouse functions to correctly cast `Vector2*` to `float*` (or `vec2`) when interfacing with the `cglm` math library, ensuring correct data layout and processing.

--------------------------------------------------------------------------------

Date: 2025-11-23
Version: 2.3.4H "Velocity" (Hotfix H)

## DESCRIPTION
The "Titanium Robustness" release.
This hotfix completes the error handling overhaul, eliminating every silent failure, double-free risk, and vague diagnostic in the codebase. Every allocation now pairs perfectly with SIT_FREE, and every potential failure path now returns a precise, actionable SituationError code. The library is now truly unbreakable — no more "it just didn't work" mysteries.

## CRITICAL FIXES

*   **Universal SIT_FREE Adoption:** Replaced every instance of `free()` with `SIT_FREE()` throughout the implementation. This ensures full allocator override compatibility (e.g., debug trackers, memory pools) without breaking any existing code.
*   **Exhaustive Error Path Coverage:** Audited and fixed 12+ silent failure spots across core functions (`SituationLoadImageFromScreen`, `SituationTakeScreenshot`, `SituationUnloadImage`, etc.):
    *   Added specific error codes for backend validations (e.g., GLAD loader fail → `SITUATION_ERROR_OPENGL_LOADER_FAILED`).
    *   Proactive checks for invalid states (e.g., zero dimensions in screenshot → `SITUATION_ERROR_NOT_INITIALIZED` with context).
    *   Defensive free checks (e.g., post-SIT_FREE errno validation in `SituationUnloadImage` and `SituationFreeDisplays`).
*   **Debug Double-Free Detection:** Enhanced `SituationFreeString` with poison-pointer tracking (debug-only) to catch use-after-free bugs immediately, preventing heap corruption.
*   **Void Function Warnings:** Introduced `SITUATION_LOG_WARNING` macro for non-fatal issues in void APIs (e.g., null params in unloads), with debug-only stderr output for zero-overhead diagnostics.

## DOCUMENTATION

*   **Error Enum Finalization:** Fully documented the expanded `SituationError` enum with every original code preserved, merged duplicates intelligently, and filled gaps for complete range utilization. Every code now has precise EOL comments explaining triggers and platform specifics.
*   **API Safety Notes:** Updated function docs for new return types (e.g., `SituationUnloadImage` now bool for failure propagation) and emphasized error querying via `SituationGetLastError()`.

## CONSISTENCY & AESTHETICS

*   **Error Uniformity:** All error sets now use `_SituationSetErrorFromCode` with specific enums and contextual messages (e.g., "%dx%d RGBA alloc failed" for screenshots). No more generic fallbacks.
*   **Memory Hygiene:** SIT_FREE macro now consistently nulls pointers post-free (updated definition: `#define SIT_FREE(p) do { if (p) { free(p); (p) = NULL; } } while(0)`).
*   **Debug Polish:** All new checks guarded by `#ifndef NDEBUG` for release-zero overhead; warnings follow the exact same tone and format as other logs.

--------------------------------------------------------------------------------

Date: 2025-11-23
Version: 2.3.4G "Velocity" (Hotfix G)

## DESCRIPTION
The "Polish" release.

## DOCUMENTATION
*   Every single struct in the public and internal API now carries full comments with logical grouping, separator lines, and deep explanatory notes.
*   The entire callback section has been rewritten for consistency, real-time safety warnings, exact format guarantees.
*   The API Usage Guide section has been replaced with a more complete version.
*   All enum blocks (SituationDataType, SituationBufferUsageFlags, barrier flags, etc.) received full professional commentary, useful combination presets, and performance guidance.
*   Custom DSP and audio capture callbacks finalised with correct float* buffers and complete real-time safety documentation.

## CONSISTENCY & AESTHETICS
*   Universal adoption of snake_case: every callback parameter is now user_data (including the MiniAudio stream callbacks).
*   SituationFocusCallback parameter renamed from focused → gained_focus for instant, unambiguous clarity.
*   All comment blocks now follow the exact same visual structure, density, and tone.
*   Minor spacing, alignment, and comment style harmonisation across the entire file.

--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.4F "Velocity" (Hotfix F)

## DESCRIPTION
This update focuses purely on code hygiene and developer reference. It finalizes the internal state architecture by applying professional, line-by-line documentation to the global state container and its subsystems. It also adds comprehensive API documentation for several core modules.

## INTERNAL REFACTORING

*   **State Structure Finalization:** Completed the cleanup of `_SituationGlobalStateContainer`.
    *   Moved all subsystem struct definitions (`_SituationKeyboardState`, `_SituationVulkanState`, etc.) outside the main container.
    *   Applied "Professional Grade" formatting: Grouped fields by logical category and added explicit End-of-Line (EOL) comments for every single variable in the global state.

## DOCUMENTATION

*   **API Reference:** Added detailed Doxygen-style headers for the following functions:
    *   **Display:** `SituationSetDisplayMode`, `SituationRefreshDisplays`, `_SituationGetCurrentDisplayIdentifier`, `_SituationCachePhysicalDisplays`.
    *   **Filesystem:** `SituationGetUserDirectory`, `SituationLoadDroppedFiles`, `SituationUnloadDroppedFiles`.
    *   **Input:** `SituationIsFileDropped`, `SituationSetFileDropCallback`, `SituationSetClipboardText`, `SituationGetClipboardText`.
    *   **Lifecycle:** `SituationIsInitialized`, `_SituationCleanupDanglingResources`.
    *   **Rendering:** `SituationCmdBeginRenderPass`, `SituationCmdEndRenderPass`.
	
--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.4E "Velocity" (Hotfix E)

## DESCRIPTION
This update completes the architectural refactoring started in Hotfix D, solidifying the internal state management and fixing critical initialization bugs. It also standardizes the documentation for core APIs, making the library easier to maintain and integrate.

## CRITICAL FIXES

*   **Input Subsystem Initialization:** Fixed a severe regression in `_SituationInitSubsystems` where `memset` was called *after* mutex initialization, corrupting the keyboard event lock and causing potential deadlocks. The memory zeroing now correctly happens before resource allocation.

*   **Render Pass Logic:** Replaced placeholder pseudo-code in `SituationCmdBeginRenderPass` with a fully functional implementation.
    *   **OpenGL:** Now correctly handles Virtual Display targets and `glClearColor` type casting.
    *   **Vulkan:** Now correctly delegates standard clear operations and safely rejects unsupported `LOAD_OP_LOAD` requests instead of crashing.

## DOCUMENTATION

*   **API Reference:** Added comprehensive Doxygen-style documentation for:
    *   Display Management (`SituationSetDisplayMode`, `SituationRefreshDisplays`)
    *   Filesystem (`SituationGetUserDirectory`, `SituationLoadDroppedFiles`)
    *   Input & Clipboard (`SituationIsFileDropped`, `SituationGetClipboardText`)
    *   Core Lifecycle (`SituationIsInitialized`, `_SituationCleanupDanglingResources`)
    *   Render Pass Control (`SituationCmdBeginRenderPass`, `SituationCmdEndRenderPass`)

--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.4D "Velocity" (Hotfix D)

## DESCRIPTION
This update focuses on code hygiene and architectural clarity. It refactors the internal global state container, breaking it down into distinct, self-documenting structures for each subsystem (Input, Audio, Backend). This change improves readability and maintainability without altering the public API or runtime behavior.

## INTERNAL REFACTORING

*   **State Container Modernization:** 
    *   Decomposed `_SituationGlobalStateContainer` into logical sub-structures:
        *   `_SituationKeyboardState`: Encapsulates key arrays, ring buffers, and the event mutex.
        *   `_SituationMouseState`: Encapsulates position, buttons, and scrolling data.
        *   `_SituationJoystickManager`: Encapsulates controller states and connection events.
        *   `_SituationGLState` / `_SituationVulkanState`: Segregated backend-specific resources.
    *   This grouping makes the global state definition significantly easier to parse and manage.

*   **Naming Consistency:**
    *   Moved the keyboard event mutex inside the keyboard state struct (`sit_gs.keyboard.event_queue_mutex`) to match the pattern used by the mouse and joystick subsystems.
    *   Standardized initialization order in `_SituationInitSubsystems` to prevent mutex corruption during state zeroing.

*   **Documentation:** Added comprehensive Doxygen headers to all new internal structures to explain their specific roles in the engine lifecycle.

--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.4C "Velocity" (Hotfix C)

## DESCRIPTION
This update finalizes the strict C11 compliance overhaul and refactors the internal state architecture for better consistency between backends. It resolves several compilation errors related to function signatures and macro definitions that appeared when building against strict standards.

## CRITICAL FIXES

*   **Function Signature Mismatch:** Fixed a critical bug in `SituationCmdBindVertexBuffer` where the implementation signature did not match the header declaration, causing immediate compilation failure.

*   **Extension Macro Safety:** Fixed `SituationGetVRAMUsage` to correctly guard GLAD extension macros (like `GL_NVX_gpu_memory_info`) with `#ifdef`. This prevents "undeclared identifier" errors when compiling with headers that don't include specific vendor extensions.

*   **Control Flow Safety:** Refactored `SituationCreateVirtualDisplay` to replace `goto` error handling with a structured control flow. This eliminates potential "jump bypasses variable initialization" warnings in strict C modes.

## INTERNAL REFACTORING

*   **Global State Architecture:** Refactored the `_SituationGlobalStateContainer`. OpenGL state variables are now grouped into a dedicated `_SituationGLState` struct (`sit_gs.gl`), mirroring the Vulkan backend's structure. This improves code organization and maintainability.

*   **Standard Compliance:**
    *   Added `_POSIX_C_SOURCE` and `_XOPEN_SOURCE` feature macros to correctly expose system headers on Linux/macOS.
    *   Replaced all C++ style empty initializers (`{}`) with C11 universal zero initializers (`{0}`).
    *   Implemented internal helpers `_sit_strdup` and `_sit_strcasecmp` to remove dependency on non-standard headers.
    *   Replaced deprecated `usleep` with `nanosleep` for POSIX frame limiting.

--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.4B "Velocity" (Hotfix B)

## DESCRIPTION
This update focuses on achieving strict standard compliance and cross-platform portability. It eliminates non-standard C extensions, ensuring the library compiles cleanly under strict C11 environments (e.g., `gcc -std=c11 -pedantic`) while maintaining full backend fidelity.

## CRITICAL FIXES

*   **Strict C11 Syntax:** Replaced all instances of C++ style empty struct initialization (`{}`) with the universal zero initializer (`{0}`). This resolves syntax errors in strict C compilers throughout the Vulkan backend and internal structures.

*   **Portability Layer:** Replaced non-standard POSIX string functions (`strdup`, `strcasecmp`) and threading calls (`usleep`) with internal, standard-compliant helper implementations (`_sit_strdup`, `_sit_strcasecmp`, `nanosleep`). Added necessary feature test macros (`_POSIX_C_SOURCE`) to correctly expose system headers on Linux/macOS.

*   **Control Flow Refactoring:** Rewrote `SituationCreateVirtualDisplay` to eliminate `goto` statements and fix variable scoping issues. This prevents "jump bypasses initialization" warnings and improves code safety during resource cleanup.

*   **Math Constants:** Added fallback definitions for `M_PI_2` to ensure compilation on MSVC and strict C11 math environments where non-standard constants are not defined by default.

--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.4A "Velocity" (Hotfix)

## DESCRIPTION
This patch solidifies the "Velocity" feature set, addressing specific architectural constraints in the Vulkan backend and ensuring strict C standard compliance. It transforms the Virtual Display compositor into a "Titanium" grade implementation, guaranteeing validation-free operation for advanced blending modes.

## CRITICAL FIXES

*   **Vulkan Compositor Architecture:** Completely rewrote the `SituationRenderVirtualDisplays` logic for Vulkan. It now automatically manages Render Pass state (starting/stopping) to perform legal `vkCmdCopyImage` operations. This fixes validation errors when using "Screen Grab" blend modes (Overlay, Soft Light) and ensures correct layering over the main scene.

*   **Scaling Math Correction:** Fixed the matrix calculation for `SITUATION_SCALING_STRETCH`. It now correctly scales content to fill the *target* framebuffer dimensions rather than preserving the source resolution 1:1.

*   **Strict C Compliance:** Removed C++-style syntax (lambdas and anonymous struct initializers) from the implementation block. The library now compiles cleanly on strict C99/C11 compilers (MSVC/GCC/Clang) without warnings.

## DOCUMENTATION

*   **API Reference:** Added comprehensive Doxygen-style header documentation for the entire Hot-Reloading module (`SituationReloadShader`, `SituationReloadTexture`, etc.), detailing synchronization behavior and usage constraints.

--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.4 "Velocity"

## DESCRIPTION
This release transforms "Situation" from a static framework into a live development environment. The "Velocity" update introduces a comprehensive **Hot-Reloading Module**, allowing developers to modify Shaders, Compute Pipelines, Textures, and 3D Models on disk and see the changes instantly in the running application without restarting. This feature significantly accelerates the iteration loop for visual adjustments and shader programming.

## NEW FEATURES

*   **Hot-Reloading Module:** Added a suite of functions to safely reload assets at runtime. The engine handles the complex task of synchronization with the GPU, ensuring the device is idle, destroying old resources, and seamlessly swapping in the new data while maintaining the original handle IDs.
    *   `SituationReloadShader`: Recompiles and links graphics pipelines.
    *   `SituationReloadComputePipeline`: Recompiles compute shaders, preserving the original layout configuration.
    *   `SituationReloadTexture`: Re-uploads image data to GPU memory (requires texture to be loaded from file).
    *   `SituationReloadModel`: Re-parses GLTF/GLB files and rebuilds all sub-meshes and material textures.

*   **Texture Loading Helper:** Added `SituationLoadTexture(path, mips)`. This new high-level function combines image loading, texture creation, and cleanup into one call. Crucially, it registers the file path with the internal resource tracker, making the texture eligible for hot-reloading.

*   **Shader #include Support:** The runtime GLSL compiler (`shaderc` integration) now supports `#include "filename.glsl"` directives. This allows developers to construct complex "Uber Shaders" by sharing common logic and struct definitions across multiple shader files.

## CRITICAL BUG FIXES

*   **Vulkan Stale Layout Crash:** Fixed a "time bomb" crash in the Vulkan backend where a failed shader hot-reload (e.g., due to syntax error) would destroy the pipeline layout but leave a dangling pointer in the global state cache. Subsequent calls to `SituationCmdSetPushConstant` would then crash the driver. The system now correctly invalidates the cached layout on binding failure.

## INTERNAL IMPROVEMENTS

*   **Resource Path Tracking:** The internal linked-list resource managers have been upgraded to store the source file paths of loaded assets.
    *   Updated all `SituationLoad*` functions to capture and store these paths upon successful creation.
    *   Updated all `SituationDestroy*` and `SituationUnload*` functions to correctly free these path strings, ensuring zero memory leaks.

*   **Compute Pipeline State:** Updated `_SituationComputePipelineNode` to cache the `SituationComputeLayoutType` used during creation. This ensures that when a compute pipeline is hot-reloaded, it is rebuilt with the exact same descriptor layout as the original.

--------------------------------------------------------------------------------

Date: 2025-11-22
Version: 2.3.3D "Production"

## DESCRIPTION
This patch resolves three high-priority logic errors discovered in the Vulkan and Audio backends of the "Hardened" release. While 2.3.3C introduced the architecture for robustness, 2.3.3D connects the final wires to ensure those systems function correctly under real-world stress tests. It is highly recommended for all users to update to this version immediately.

## CRITICAL BUG FIXES

*   **Audio Capture Dispatch:** Fixed a "phantom" logic bug where the audio capture callback was executing on the high-priority audio thread, completely bypassing the thread-safe ring buffer intended for the main thread. The callback now correctly linearizes data into the ring buffer, ensuring thread safety for user logic.

*   **Vulkan Screenshot Crash:** Fixed a validation error and potential device loss when calling `SituationTakeScreenshot` inside a render loop. The image layout transition was incorrectly assuming `PRESENT_SRC`, causing barriers to fail. It now correctly handles `COLOR_ATTACHMENT_OPTIMAL` transitions.

*   **Pipeline Layout Leak:** Added missing cleanup logic in `_SituationVulkanCreateComputePipeline`. Previously, if shader compilation failed or the pipeline creation errored, the intermediate `VkPipelineLayout` object was leaked on the GPU.

## ARCHITECTURAL IMPROVEMENTS

*   **Dynamic Descriptor Manager:** Finalized the implementation of the dynamic descriptor pool system.
    *   Added the `descriptor_manager` struct to the global Vulkan state.
    *   Implemented `_SituationVulkanAllocateDescriptorSet` to automatically create and register new descriptor pools when the current one fills up.
    *   Fixed initialization logic to correctly "seed" the manager with the initial persistent pool, preventing immediate duplicate pool creation on startup.

*   **Backend Consistency:** Added internal state tracking (`debug_draw_command_issued_this_frame`) to detect and warn developers (in debug builds) if `SituationUpdateBuffer` is called after draw commands, preventing divergent behavior between OpenGL (Immediate) and Vulkan (Deferred) backends.

--------------------------------------------------------------------------------

Date: 2025-11-21
Version: 2.3.3C "Hardened"

## DESCRIPTION
This release is a major stability overhaul focused on thread safety, resource management, and preventing runtime crashes in long-running applications. It addresses several critical architectural flaws identified in the Audio and Vulkan backends, transforming the library from a prototype into a production-ready framework.

## BREAKING API CHANGES

*   **Audio Loading Strategy:** The signature of `SituationLoadSoundFromFile` has changed.
    *   *Old:* `(path, looping, out_sound)`
    *   *New:* `(path, mode, looping, out_sound)`
    *   *Reason:* Users must now specify `SITUATION_AUDIO_LOAD_AUTO`, `FULL` (RAM decode), or `STREAM` (Disk I/O) to prevent the audio thread from blocking on disk operations.

## CRITICAL STABILITY FIXES

*   **Audio Thread "Death Spiral":** Completely rewrote the audio loading logic. Short sounds (SFX) are now decoded fully to RAM upon load. The audio callback no longer performs blocking disk I/O for these sounds, eliminating stuttering/popping during gameplay or background loading.

*   **Vulkan Descriptor Exhaustion:** Replaced the fixed-size descriptor pool (limit 512) with a **Dynamic Descriptor Manager**. The engine now automatically allocates new pools as needed, allowing for an effectively infinite number of textures and materials.

*   **OpenGL State Leak:** Implemented a "State Guard" in `SituationRenderVirtualDisplays`. The compositor now backs up the active Shader Program, VAO, Texture Units, and Blend Modes before rendering and restores them exactly afterwards. This prevents internal rendering passes from corrupting user rendering state.

*   **Compute Pipeline Crash:** Fixed a severe memory offset bug in `SituationDestroyComputePipeline`. The function was passing a public struct pointer to an internal helper expecting a different memory layout, which would have caused heap corruption or driver crashes on cleanup.

## OPTIMIZATIONS

*   **O(1) Input Processing:** Replaced the `O(N)` memory-shifting queues in the Keyboard, Mouse, and Gamepad subsystems with **Ring Buffers**. Input processing time is now constant regardless of queue depth.

*   **Audio Capture Logic:** Fixed a logic hole in `SituationPollInputEvents` where captured audio data was locked but never dispatched to the user. Added a thread-safe linearization step to correctly pass ring-buffer data to the user callback.

--------------------------------------------------------------------------------

Date: 2025-11-21
Version: 2.3.3B "Refinement"

## DESCRIPTION
This patch release resolves critical compilation errors in the Vulkan backend introduced in 2.3.3A. It solidifies the "Unified Resource" system, ensuring textures and compute pipelines are correctly configured and stable across both backends.

## API CHANGES & IMPROVEMENTS

*   **Unified Texture Creation:** `SituationCreateTexture()` now automatically applies `VK_IMAGE_USAGE_STORAGE_BIT` (Vulkan) and compatible storage flags (OpenGL) to all new textures.
    *   *Impact:* All textures created via the standard API are now "Compute-Ready" by default. Users can bind any texture to a Compute Shader without needing special creation flags or distinct API calls.

## BUG FIXES

*   **Vulkan Compilation:** Resolved an undefined variable error (`usage_flags`) inside `SituationCreateTexture` that prevented the library from compiling when `SITUATION_USE_VULKAN` was defined.

*   **Missing Definitions:** Added the missing `SituationTextureUsageFlags` enum and replaced undefined macros in `_SituationInitVulkan` with defined numeric constants for descriptor pool sizing.

*   **Compute Binding Crash:** Fixed a runtime crash during Vulkan initialization by ensuring the `storage_image_layout` is correctly created. This resolves issues when attempting to bind textures to Compute Shaders.

--------------------------------------------------------------------------------

Date: 2025-11-21
Version: 2.3.3A "Refinement"

## DESCRIPTION
This maintenance release tightens the API surface and improves developer ergonomics. It addresses several "friction points" identified in previous versions, particularly around string handling and file export safety.

## API CHANGES & IMPROVEMENTS

*   **Static Version String:** `SituationGetVersionString()` now returns a pointer to a static, read-only string buffer.
    *   *Impact:* Users no longer need to `free()` the returned pointer, making version logging a simple one-liner: `printf("Situation v%s\n", SituationGetVersionString());`.
    
*   **Strict PNG Screenshots:** `SituationTakeScreenshot()` now strictly enforces the `.png` file extension.
    *   *Impact:* Prevents silent failures or garbage output when users attempt to save with unsupported extensions (like `.jpg` or `.txt`). The function now returns `false` and sets a clear error message if a non-PNG path is provided.
    *   *Cleanup:* The legacy BMP fallback writer has been removed to reduce binary size and maintenance surface area.

*   **Documentation:** Added comprehensive internal documentation for complex Vulkan helpers (e.g., `_SituationVulkanBlitImageToHostVisibleBuffer`) to aid future maintenance and auditing.

## BUG FIXES

*   **VRAM Reporting:** Implemented a multi-backend strategy for `SituationGetVRAMUsage()`. It now supports Windows (DXGI), Vulkan (VMA), and NVIDIA OpenGL extensions, providing accurate memory tracking across a wider range of configurations.

--------------------------------------------------------------------------------

Date: 2025-11-21
Version: 2.3.3 "Insight"

## DESCRIPTION
Version 2.3.3 is a "quality of life" feature release that expands the developer's ability to monitor performance and embed assets. It introduces the "Small but Deadly" feature set: direct memory loading for fonts, formatted text drawing, and hardware profiling hooks.

## NEW FEATURES

*   **Memory Asset Loading:** Added `SituationLoadFontFromMemory`. This allows developers to embed fonts (e.g., using `xxd -i`) directly into their executable for truly single-file distribution, bypassing the filesystem.
*   **Formatted Text:** Added `SituationImageDrawTextFormatted`. This convenience function accepts `printf`-style format strings (e.g., `"Score: %d", score`), eliminating the need for users to manually `snprintf` into temporary buffers before drawing text.
*   **Hardware Info:** Added `SituationGetGPUName()` to retrieve the human-readable model name of the active graphics adapter.

## PROFILING & DIAGNOSTICS

*   **Draw Call Counting:** The engine now tracks the number of draw commands issued per frame. This data is accessible via `SituationGetDrawCallCount()`.
*   **VRAM Monitoring:** On Vulkan, `SituationGetVRAMUsage()` now returns the precise number of bytes allocated by the engine's internal allocator (VMA), allowing for real-time memory budget monitoring.

## INTERNAL IMPROVEMENTS

*   **Quad Renderer Refactor:** The internal 2D quad renderer has been modernized (Phase 2.5 prep). It now supports dynamic UV coordinates via push constants, paving the way for future GPU-accelerated text rendering.
*   **Pipeline Layout Optimization:** Vulkan internal pipelines now use more efficient layout creation strategies, reducing initialization overhead.

--------------------------------------------------------------------------------

Date: 2025-11-20
Version: 2.3.2D "Integrity"

## DESCRIPTION
This is a critical stability release. It addresses a severe race condition in the audio streaming subsystem, plugs memory leaks in the Vulkan swapchain recreation logic, and ensures OpenGL state isolation.

## CRITICAL FIXES

*   **Audio Stream Thread-Safety:** Completely refactored `SituationLoadSoundFromStream`. Previously, a shared global vtable caused race conditions and data corruption when loading multiple streams. This has been replaced with instance-based callback storage and static thunks, ensuring complete isolation and thread safety.
*   **Vulkan Swapchain Leak:** Fixed a memory leak where the `swapchain_images` handle array was not freed during swapchain recreation (e.g., window resize).
*   **OpenGL State Corruption:** `SituationRenderVirtualDisplays` now correctly saves and restores the Depth Test state (`GL_DEPTH_TEST`), preventing it from accidentally enabling depth testing for subsequent 2D rendering passes.

## LOGIC & SAFETY

*   **Vulkan Pipeline Barriers:** Fixed logic that prevented Execution-Only barriers (barriers with 0 access masks but valid stage masks) from being recorded.
*   **Model Loading Safety:** `SituationLoadModel` now validates texture creation. If a texture file is missing, it logs a warning instead of assigning a null ID, preventing silent rendering failures.
*   **Shader Debugging:** Increased the internal error message buffer size (to 2048 bytes) to prevent truncation of complex GLSL compilation errors.
*   **API Clarity:** `SituationCmdSetVertexAttribute` now returns a precise error message on Vulkan, explaining that vertex formats are immutable in that backend.

--------------------------------------------------------------------------------

Date: 2025-11-20
Version: 2.3.2C "Zero Friction"

## DESCRIPTION
This micro-release focuses purely on developer experience and removal of friction. It transforms "Situation" into a true "drop-in" library where advanced features like image loading, screenshots, and text rendering work immediately without external configuration.

## ZERO FRICTION UPDATES

*   **Embedded STB Libraries:** `stb_image`, `stb_image_write`, and `stb_truetype` are now automatically implemented by `SITUATION_IMPLEMENTATION`.
    *   **Impact:** `SituationLoadImage`, `SituationTakeScreenshot(.png)`, and `SituationDrawTextStyled` work out-of-the-box with zero additional defines or includes.
    *   **Opt-Out:** Users can define `SITUATION_NO_STB` (or specific flags like `SITUATION_NO_STB_IMAGE`) to disable this if they manage dependencies externally.

## API ADDITIONS

*   **Version Querying:** Added `SITUATION_VERSION_MAJOR/MINOR/PATCH` macros and `SituationGetVersionString()` for runtime version checking.

## SUMMARY
With 2.3.2C, the "Hello World" for a graphical, audio-enabled application with font support is now literally one C file with two #defines.

--------------------------------------------------------------------------------

Date: 2025-11-20
Version: 2.3.2B "Consistency"

## DESCRIPTION
This hotfix eliminates cross-backend inconsistencies and improves safety. The execution-model difference between OpenGL and Vulkan is now actively enforced in debug builds.

## CRITICAL FIXES & BEHAVIORAL GUARANTEES

*   **Enforced Buffer-Update-Before-Draw Rule:** In OpenGL debug builds, `SituationUpdateBuffer` now triggers a loud warning/error if called *after* any draw command in the current frame. This prevents the most common cause of cross-backend logic divergence.
*   **SituationSetGamepadVibration Return Type:** Now returns `bool` (true on success) instead of `void`. It correctly returns `false` and sets an error on non-Windows platforms.
*   **PNG Screenshots:** `stb_image_write.h` is now automatically implemented if available (unless `SITUATION_NO_STB_PNG` is defined), fixing silent failures when saving PNGs.

## USABILITY

*   **SITUATION_BEGIN_FRAME():** Added a macro to standardize the start of the render loop (`PollInput` + `UpdateTimers`).
*   **Main-Thread Audio Capture:** Added `SITUATION_INIT_AUDIO_CAPTURE_MAIN_THREAD` flag to `SituationInitInfo`. When set, audio capture callbacks are safely routed to the main thread during `SituationPollInputEvents`, preventing threading crashes for users.
*   **Vulkan No-Shaderc Fallback:** Internal 2D renderers now elegantly disable themselves if `SITUATION_ENABLE_SHADER_COMPILER` is not defined, removing the hard dependency on `shaderc` for basic initialization.

## INTERNAL REFACTORING

*   **Vulkan Pipeline Optimization:** Refactored the internal Advanced Compositing pipeline initialization. It now reuses existing descriptor set layouts instead of allocating temporary ones, reducing code size and initialization overhead.

--------------------------------------------------------------------------------

Date: 2025-11-20
Version: 2.3.2A "Hotfix"

## DESCRIPTION

This is a maintenance release addressing critical issues identified in the v2.3.2 "Parity" release. It focuses on correcting data capture logic in Vulkan, improving cross-platform error reporting, and loosening dependency requirements.

## CRITICAL FIXES

*   **Fixed Vulkan Screenshot Source:** `SituationLoadImageFromScreen` (and by extension `SituationTakeScreenshot`) now captures the `current_image_index` instead of `last_presented_image_index`. Previously, taking a screenshot in Vulkan would capture the *previous* frame's output.

*   **Non-Windows Gamepad Error:** `SituationSetGamepadVibration` now properly sets the `SITUATION_ERROR_NOT_IMPLEMENTED` error code on Linux and macOS, rather than failing silently.

*   **Optional Shaderc Dependency:** The `#error` forcing `SITUATION_ENABLE_SHADER_COMPILER` for Vulkan has been removed. Users can now compile the Vulkan backend without `shaderc` if they provide their own pre-compiled SPIR-V pipelines.
    *   *Note:* Disabling the compiler disables the internal 2D renderers (`SituationCmdDrawQuad` and Virtual Displays) on Vulkan, as they rely on runtime GLSL compilation.

## DOCUMENTATION

*   **Execution Model Warning:** Added a critical warning to the documentation regarding the Immediate (OpenGL) vs. Deferred (Vulkan) execution models. Developers are strictly advised to update all buffer data *before* recording draw commands to ensure consistent behavior across backends.

--------------------------------------------------------------------------------

Date: 2025-11-19
Version: 2.3.2 "Parity"

## DESCRIPTION

Version 2.3.2 addresses the major feature gaps identified in previous versions, achieving functional parity between the OpenGL and Vulkan backends, and introducing key new capabilities. This release enables "Advanced Blending" for Vulkan Virtual Displays, adds a complete Audio Capture (Microphone) API, and finalizes the 3D Model Exporting tools. Under the hood, it includes critical fixes for Vulkan synchronization (pipeline barriers), memory safety, and descriptor binding logic.

## NEW FEATURES

*   **Audio Capture API:** Added `SituationStartAudioCapture`, `SituationStopAudioCapture`, and the `SituationAudioCaptureCallback` type. This allows applications to record raw audio data (Mono, 32-bit Float, 44.1kHz) from the system's default input device for real-time processing.

*   **Vulkan Advanced Blending:** Implemented the complex "Copy-Before-Draw" architecture for the Vulkan backend. `SituationRenderVirtualDisplays` now correctly handles advanced blend modes (Overlay, Soft Light, etc.) on Vulkan by copying the swapchain image to a readable texture before rendering, matching the visual fidelity of the OpenGL backend.

*   **3D Model Exporting:** Finalized the `SituationSaveModelAsGltf` utility. This required implementing the previously stubbed `SituationGetMeshData` function to perform geometry readback from the GPU to CPU memory, enabling users to save runtime-generated or modified meshes to standard `.gltf` files.

## IMPROVEMENTS & FIXES

### [CRITICAL] Vulkan Synchronization & Stability
*   **Fixed Buffer Readback Synchronization:** Completely refactored `SituationGetBufferData`. It now uses a new internal helper `_SituationVulkanReadBackBuffer` that correctly inserts `vkCmdPipelineBarrier` commands before and after transfers. This fixes race conditions where the CPU would read stale data before the GPU finished writing.
*   **Fixed Texture Usage Flags:** `SituationCreateTexture` now automatically includes the `VK_IMAGE_USAGE_STORAGE_BIT`. This fixes a crash/validation error when binding textures as Storage Images in compute shaders (`SituationCmdBindComputeTexture`).
*   **Fixed Memory Leaks in Buffer Updates:** Resolved memory leaks in `SituationUpdateBuffer` where temporary staging buffers were not freed if mapping or command allocation failed.

### [BUG FIXES]
*   **OpenGL Initialization:** Implemented the missing `_SituationInitGLVirtualDisplayRenderer` function. Previously, the OpenGL Virtual Display compositor relied on uninitialized Vertex Array Objects, leading to potential rendering failures.
*   **Vulkan Compute Binding:** Fixed logic in `SituationCmdBindComputeTexture` that ignored the user's `binding` parameter and always bound to index 0.
*   **API Safety:** Explicitly disabled `SituationCmdSetVertexAttribute` on the Vulkan backend (returning `SITUATION_ERROR_NOT_IMPLEMENTED`), as dynamic vertex format changes are architecturally impossible in Vulkan pipelines.

### [REFACTORING]
*   **Internal Helpers:** Refactored massive logic blocks from `SituationGetBufferData` into reusable internal helpers, which allowed `SituationGetMeshData` to share the robust memory readback logic without code duplication.
*   **Documentation:** Added comprehensive header documentation for all new internal helpers (`_SituationVulkanCreateScreenCopyResource`, `_SituationVulkanReadBackBuffer`, etc.) and updated public API headers to reflect the new capabilities.

--------------------------------------------------------------------------------

Date: 2025-10-31
Version: 2.3.1A "Refinement"

## DESCRIPTION

Version 2.3.1A is a significant quality-of-life and performance refinement of the "Base" API. This update focuses on improving API safety, enhancing performance on the Vulkan backend, achieving greater feature parity between backends, and improving documentation clarity. While introducing no new major features, this release makes the existing API more robust, efficient, and easier to use correctly.

## CHANGES & IMPROVEMENTS

### [CRITICAL] API & Main Loop Refinement

*   **Deprecated SituationUpdate():** The monolithic SituationUpdate() function has been deprecated. It encouraged a main loop structure that was less explicit and prone to off-by-one-frame input bugs.

*   **New Main Loop Workflow:** Introduced two new core functions, SituationPollInputEvents() and SituationUpdateTimers().
    -   SituationPollInputEvents() is now the dedicated function for gathering all OS events and updating input state for the current frame.
    -   SituationUpdateTimers() is the dedicated function for advancing all internal clocks, calculating delta time, and updating joystick/gamepad state.

*   **Updated Documentation:** The API documentation has been updated to reflect this new, clearer main loop structure, providing a best-practice example to guide users.

### [PERFORMANCE] Vulkan Backend Enhancements

*   **High-Performance Virtual Display Compositing:** The SituationRenderVirtualDisplays() function on the Vulkan backend has been completely overhauled. It now uses the "Persistent Descriptor Set" pattern, pre-allocating a descriptor set for each virtual display at creation time. This eliminates all runtime descriptor allocation and updates from the main render loop, resulting in a massive performance improvement when compositing many virtual displays.

*   **Unified & Performant Resource Binding:**
    -   Introduced SituationCmdBindDescriptorSet() and SituationCmdBindTextureSet() as the new, primary API for binding buffers and textures.
    -   Deprecated the older, less explicit SituationCmdBindUniformBuffer, SituationCmdBindTexture, and SituationCmdBindComputeBuffer functions, which now wrap the new API.
    -   This change leverages the persistent descriptor set model for ALL buffers and textures, making resource binding a consistently fast, low-overhead operation on Vulkan.

### [BUG FIXES & STABILITY]

*   **Fixed Input System Crash:** Resolved a critical bug where the mouse input callbacks would attempt to use an uninitialized mutex, leading to a crash. The mouse state struct now correctly contains and initializes its mutex, ensuring thread-safe event handling.

*   **Fixed Vulkan Resource Leak:** Corrected a resource leak in the internal Vulkan pipeline creation logic. The VkPipelineLayout is now properly destroyed if the subsequent vkCreateGraphicsPipelines call fails, preventing leaks on shader compilation or linking errors.

### [DOCUMENTATION & API CLARITY]

*   **Detailed Color Function Docs:** The documentation for all color conversion functions (SituationRgbToHsv, SituationColorToYPQ, etc.) and SituationImageAdjustHSV has been significantly expanded to explain the color spaces, parameter ranges, and algorithms used.

*   **Improved Image Drawing Docs:** The documentation for all SituationImageDraw...() functions has been updated to clarify their distinct rendering methods (bitmap vs. SDF), performance characteristics, boundary handling, and alpha blending formulas.

*   **Added API Safety Functions:** Introduced new helper functions to make the library's manual memory management safer and more explicit:
    -   SituationFreeDisplays() for correctly deallocating the complex SituationDisplayInfo array.
    -   SituationFreeString() as the designated function for freeing strings returned by the library.
    -   Documentation for all functions that return heap-allocated data now explicitly points to these new, safe deallocation functions.

## KNOWN ISSUES & FEATURE GAPS

*   **Vulkan Advanced Blending:** The Vulkan backend's SituationRenderVirtualDisplays function currently only supports simple blend modes (Alpha, Additive, etc.). The complex, multi-pass logic required for advanced Photoshop-style blend modes (Overlay, Soft Light), which is fully implemented in the OpenGL backend, remains a feature gap. This will be addressed in a future update.

--------------------------------------------------------------------------------

Date: 2025-10-18
Version: 2.3.1 "Base"

## Description

Version 2.3.1, designated as the "Base" version, establishes the foundational public API for the "Situation" library. This release provides a single-file, cross-platform C/C++ library designed to abstract low-level system interactions for windowing, graphics, audio, and input. The primary goal of this version is to offer a stable, lean, and powerful foundation for building sophisticated, high-performance software, such as games, creative coding projects, and data visualization tools.

## Scope & Key Features

This version includes a comprehensive feature set across several core domains:

*   **Lifecycle & Windowing:** Full application lifecycle management (`SituationInit`, `SituationShutdown`) and robust window controls (fullscreen, borderless, multi-monitor awareness) via a GLFW3 backend.
*   **Dual Graphics Backend:** A unified graphics API with compile-time support for both modern OpenGL (4.6+ Core) and Vulkan (1.1+). This includes abstractions for shaders, meshes, textures, and generic buffers.
*   **Command Buffer Model:** A core architectural feature for recording rendering and compute commands. This provides a modern, explicit model for GPU interaction, inspired by Vulkan.
*   **Compute Shaders:** A unified API for GPGPU tasks, supporting both OpenGL Compute Shaders and Vulkan Compute Pipelines, with runtime GLSL-to-SPIR-V compilation via `shaderc`.
*   **2D & 3D Rendering:** High-level helpers for drawing 2D primitives (quads) and textured sprites, alongside a robust system for rendering 3D meshes. Includes a Virtual Display system for off-screen rendering, UI layering, and post-processing.
*   **Audio System:** A full-featured audio engine powered by `miniaudio`, supporting playback, capture, device enumeration, and a real-time effects chain (Filters, Echo, Reverb) with support for custom DSP callbacks.
*   **Input Handling:** Unified polling and event-based handling for keyboard, mouse, and gamepads.
*   **Timing System:** Includes high-resolution timers, FPS management, and an advanced "Temporal Oscillator System" for creating rhythmically synchronized events.
*   **Filesystem Utilities:** A cross-platform API for path manipulation and file I/O, including access to standard application directories.

## Implementation Details

*   **Header-Only Library:** The library is distributed as a single header file (`situation.h`). The implementation is included by defining `SITUATION_IMPLEMENTATION` in one C/C++ file.
*   **Dependencies:**
    *   **Required:** GLFW3, cglm.
    *   **Optional (Backend-Specific):** GLAD (for OpenGL), Vulkan SDK (for Vulkan).
    *   **Optional (Features):** `stb_image`, `stb_truetype`, `miniaudio`.
*   **Resource Management:** The library follows an explicit, manual resource management philosophy. All resources created with `SituationCreate*` or `SituationLoad*` functions must be manually destroyed with their corresponding `SituationDestroy*` or `SituationUnload*` functions. The library includes leak detection at shutdown to assist developers.

## Quirks & Notable Design Decisions

*   **[CRITICAL] Single-Threaded API:** All `SITAPI` functions **must** be called from the main thread (the thread that called `SituationInit`). The library is not internally synchronized, and calling API functions from other threads will lead to undefined behavior and likely crashes. Any multithreading must be managed by the client application, with communication back to the main thread for any API calls.
*   **[CRITICAL] Emulated OpenGL Command Buffer:** While the API presents a unified command buffer model, its execution differs significantly between backends. On Vulkan, commands are deferred and executed upon `SituationEndFrame()`. On OpenGL, the command buffer is an *emulation*, and `SituationCmd*` calls often translate to immediate OpenGL API calls. Developers must not write code that depends on the deferred execution of commands when using the OpenGL backend.
*   **Explicit Backend Selection:** The graphics backend (OpenGL or Vulkan) must be selected at compile time by defining either `SITUATION_USE_OPENGL` or `SITUATION_USE_VULKAN`.
*   **Manual Memory Management for Returned Data:** Functions that return dynamically allocated data (e.g., `SituationGetLastErrorMsg()`, `SituationGetDisplays()`) explicitly state that the caller is responsible for freeing the memory to prevent leaks.
